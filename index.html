<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>The Trumps</title>
  </head>
  <body>

<h1>Trumpeti dump</h1>
<p class="authors">nbs151 (Dan Graakj√¶r) &emsp; and &emsp; xtp778 (Jens Egholm)</p>

<svg></svg>


<script type="text/javascript">
  d3.select(window).on('load', () => {
    const width = window.innerWidth * 0.9;
    const height = window.innerHeight * 0.9;
    const padding = 40;

    const svg = d3.select("svg")
        .attr("width", width)
        .attr("height", height);

    const left = svg.append("g")
      .attr("width", width / 2)
      .attr("height", height / 2)

    const right = svg.append("g")
      .attr("width", width / 2)
      .attr("height", height / 2)
      .attr("transform", "translate(" + (width / 2) + ", 0)")

    const scaleLeftX = d3.scaleLinear()
      .domain([0, 1])
      .range([ padding, (width - padding) / 2 ]);

    const scaleLeftY = d3.scaleLinear()
      .domain([0, 1])
      .range([ padding , height - (padding * 2) ]);

    let hands = [];

    const updateHand = (index) => {
      const xy = hands[index];
      left.selectAll("circle")
          .data(xy)
          .attr("cx", d => scaleLeftX(d[0]))
          .attr("cy", d => scaleLeftY(d[1]))
          .attr("r", 5)
    }

  	d3.csv("hands.csv", data => {
    	const x = data.map(r => Object.keys(r).slice(0, 56).map(key => r[key]))
    	const y = data.map(r => Object.keys(r).slice(56, 112).map(key => r[key]))
    	hands = x.map((xs, xsi) => xs.map((x, xi) => [x, y[xsi][xi]]))

      left.selectAll("circle")
        .data(hands[0])
        .enter()
        .append("circle")
    });

    d3.csv("hands_pca.csv", data => {
      let maxX = 0, minX = 0
      let maxY = 0, minY = 0
      const handsPca = data.map((row, i) => {
        minX = row[1] < minX ? row[1] : minX
        maxX = row[1] > maxX ? row[1] : maxX
        minY = row[2] < minY ? row[2] : minY
        maxY = row[2] > maxY ? row[2] : maxY
        return [row[1], row[2], i]
      })

      const scaleRightX = d3.scaleLinear()
        .domain([minX, maxX])
        .range([ padding, (width - padding) / 2 ]);

      const scaleRightY = d3.scaleLinear()
        .domain([minY, maxY])
        .range([ padding , height - (padding * 2) ]);

      const diagram = d3.voronoi(handsPca)
        .x(d => scaleRightX(d[0]))
        .y(d => scaleRightY(d[1]))(handsPca)
      const cells = diagram.cells
      const polygons = diagram.polygons()

      const border = right.append("g")
        .attr("class", "cell")
        .selectAll("cell")
        .data(polygons)
        .enter().append("g")

      border.append("path")
          .attr("class", "cell-border")
          .attr("d", d => "M" + d.filter(xy => xy != null).join("L") + "Z")


        // .data()
        // console.log(voronoi.find(0, 0))
      // right.selectAll("pca-dots").data(handsPca)
      //   .enter()
      //   .append("circle")
      //   .attr("cx", d => scaleRightX(d[0]))
      //   .attr("cy", d => scaleRightY(d[1]))
      //   .attr("r", 20)
      //   .on("mouseover", d => updateHand(d[2]))
    })

});
</script>
  </body>
</html>
