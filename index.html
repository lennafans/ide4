<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>The Trumps</title>
  </head>
  <body>
<style>

.cell {
  fill: #fff;
  stroke: #000;
}
</style>
<h1>Trumpeti dump</h1>
<p class="authors">nbs151 (Dan Graakj√¶r) &emsp; and &emsp; xtp778 (Jens Egholm)</p>

<svg></svg>


<script type="text/javascript">
  d3.select(window).on('load', () => {
    const width = window.innerWidth * 0.9;
    const height = window.innerHeight * 0.8;
    const padding = 40;

    const svg = d3.select("svg")
        .attr("width", width)
        .attr("height", height);

    const left = svg.append("g")
      .attr("width", width / 2)
      .attr("height", height / 2)

    const right = svg.append("g")
      .attr("width", width / 2)
      .attr("height", height / 2)
      .attr("transform", "translate(" + (width / 2) + ", 0)")

    const scaleLeftX = d3.scaleLinear()
      .domain([0.2, 1.2])
      .range([ padding, (width - padding) / 2 ]);

    const scaleLeftY = d3.scaleLinear()
      .domain([0, 1])
      .range([ padding , height - (padding * 2) ]);

    let hands = [];

    const updateHand = (index) => {
      const xy = hands[index];
      left.selectAll("circle")
          .data(xy)
          .attr("cx", d => scaleLeftX(d[0]))
          .attr("cy", d => scaleLeftY(d[1]))
          .attr("r", 5)
    }

  	d3.csv("hands.csv", data => {
    	const x = data.map(r => Object.keys(r).slice(0, 56).map(key => r[key]))
    	const y = data.map(r => Object.keys(r).slice(56, 112).map(key => r[key]))
    	hands = x.map((xs, xsi) => xs.map((x, xi) => [x, y[xsi][xi]]))

      left.selectAll("circle")
        .data(hands[0])
        .enter()
        .append("circle")
    });

    d3.csv("hands_pca.csv", data => {
      let maxX = 0, minX = 0
      let maxY = 0, minY = 0
      const handsPca = data.map((row, i) => {
        minX = Math.min(row[1], minX)
        maxX = Math.max(row[1], maxX)
        minY = Math.min(row[2], minY)
        maxY = Math.max(row[2], maxY)
        return [row[1], row[2], i]
      })

      const scaleRightX = d3.scaleLinear()
        .domain([minX, maxX])
        .range([ 0, (width / 2) ]);

      const scaleRightY = d3.scaleLinear()
        .domain([minY, maxY])
        .range([ 0, height ]);

      const diagram = d3.voronoi()
        .x(d => scaleRightX(d[0]))
        .y(d => scaleRightY(d[1]))
        .size([width / 2, height])(handsPca)
      const cells = diagram.cells
      const polygons = diagram.polygons()

      const border = right.append("g")
        .attr("class", "cell")
        .selectAll("cell")
        .data(polygons)
        .enter().append("g")

      border.append("path")
          .attr("class", "cell-border")
          .attr("d", d => "M" + d.filter(xy => xy != null).join("L") + "Z")

      const sites = diagram["cells"].map(c => c["site"])
      right.on("mousemove", function() {
        const mouse = d3.mouse(this)
        const closest = diagram.find(mouse[0], mouse[1])
        const index = sites.findIndex(x => x == closest)
        updateHand(index)
      })
    })

});
</script>
  </body>
</html>
